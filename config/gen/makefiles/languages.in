# $Id$

# setup of commands
@make_set_make@
PERL          = @perl@
MAKE          = @make_c@
RM_F          = @rm_f@
BUILD_DIR     = @build_dir@
RECONFIGURE   = $(PERL) @build_dir@/tools/dev/reconfigure.pl

# add new languages here
# remove obsolete languages here
LANGUAGES = \
    abc APL \
    BASIC befunge bf \
    c99 cardinal chitchat cola \
    dotnet \
    eclectus ecmascript \
    forth \
    hq9plus \
    jako json \
    lazy-k lisp lolcode lua \
    m4 \
    ook \
    parrot_compiler perl6 pheme PIR pipp punie pynie \
    regex \
    scheme squaak \
    tcl \
    unlambda urm \
    WMLScript \
    Zcode

# the default target
all: $(LANGUAGES)

# This is a listing of all targets, that are meant to be called by users
help:
	@echo ""
	@echo "Following targets are available for the user:"
	@echo ""
	@echo "  all:           Make a lot of language implementations."
	@echo "                 This is the default."
	@echo ""
	@echo "  test:          Same as test-unified."
	@echo ""
	@echo "  test-unified:  Unified test suite for a lot of languages."
	@echo ""
	@echo "  test-separate: Run 'make test' in the individual lang dirs."
	@echo ""
	@echo "  installable:   Create self-hosting bins and libs."
	@echo ""
	@echo "  test-installable: Test self-hosting bins and libs."
	@echo ""
	@echo "  install:       Copy installable and more to DESTDIR."
	@echo ""
	@echo "  clean:         Clean up a lot of languages."
	@echo ""
	@echo "  help:          Print this help message."
	@echo ""
	@echo "  smoke:         Run the unified test suite and send smoke.html to "
	@echo "                 http://smoke.parrotcode.org/"
	@echo ""
	@echo "  smoke-clean:   clean up smoke.html"
	@echo ""
	@echo ""
	@echo "Following languages are available:"
	@echo "  $(LANGUAGES)"
	@echo ""
	@echo "A particular language <lang> can be built, tested and cleaned up"
	@echo "  make <lang>"
	@echo "  make <lang>.test"
	@echo "  make <lang>.installable"
	@echo "  make <lang>.test-installable"
	@echo "  make <lang>.install"
	@echo "  make <lang>.clean"
	@echo "  make <lang>.realclean"
	@echo ""
	@echo "For the status of individual languages see LANGUAGES_STATUS.pod"
	@echo ""

# regenerate the Makefile
Makefile: ../config/gen/makefiles/languages.in
	cd $(BUILD_DIR) && $(RECONFIGURE) --step=gen::languages --languages=""

test:   test-unified

test-unified: all
	$(PERL) t/harness

test-separate: all \
    abc.test APL.test \
    befunge.test bf.test \
    c99.test cardinal.test chitchat.test cola.test \
    dotnet.test \
    eclectus.test ecmascript.test \
    forth.test \
    hq9plus.test \
    jako.test json.test \
    lazy-k.test lisp.test lolcode.test lua.test \
    m4.test \
    ook.test \
    parrot_compiler.test perl6.test pheme.test PIR.test pipp.test punie.test pynie.test \
    regex.test \
    scheme.test squaak.test \
    tcl.test \
    urm.test unlambda.test \
    WMLScript.test \
    Zcode.test

installable : all \
    abc.installable APL.installable \
    befunge.installable bf.installable \
    c99.installable cardinal.installable chitchat.installable cola.installable \
    dotnet.installable \
    eclectus.installable ecmascript.installable \
    forth.installable \
    hq9plus.installable \
    jako.installable json.installable \
    lazy-k.installable lisp.installable lolcode.installable lua.installable \
    m4.installable \
    ook.installable \
    parrot_compiler.installable perl6.installable pheme.installable PIR.installable pipp.installable punie.installable pynie.installable \
    regex.installable \
    scheme.installable squaak.installable \
    tcl.installable \
    urm.installable unlambda.installable \
    WMLScript.installable \
    Zcode.installable

test-installable : all \
    abc.test-installable APL.test-installable \
    befunge.test-installable bf.test-installable \
    c99.test-installable cardinal.test-installable chitchat.test-installable cola.test-installable \
    dotnet.test-installable \
    eclectus.test-installable ecmascript.test-installable \
    forth.test-installable \
    hq9plus.test-installable \
    jako.test-installable json.test-installable \
    lazy-k.test-installable lisp.test-installable lolcode.test-installable lua.test-installable \
    m4.test-installable \
    ook.test-installable \
    parrot_compiler.test-installable perl6.test-installable pheme.test-installable PIR.test-installable pipp.test-installable punie.test-installable pynie.test-installable \
    regex.test-installable \
    scheme.test-installable squaak.test-installable \
    tcl.test-installable \
    urm.test-installable unlambda.test-installable \
    WMLScript.test-installable \
    Zcode.test-installable

install : all \
    abc.install APL.install \
    befunge.install bf.install \
    c99.install cardinal.install chitchat.install cola.install \
    dotnet.install \
    eclectus.install ecmascript.install \
    forth.install \
    hq9plus.install \
    jako.install json.install \
    lazy-k.install lisp.install lolcode.install lua.install \
    m4.install \
    ook.install \
    parrot_compiler.install perl6.install pheme.install PIR.install pipp.install punie.install pynie.install \
    regex.install \
    scheme.install squaak.install \
    tcl.install \
    urm.install unlambda.install \
    WMLScript.install \
    Zcode.install

smoke:  all
	$(PERL) t/harness --html
	$(PERL) ../tools/util/smokeserv-client.pl languages_smoke.html

smoke-clean :
	$(RM_F) languages_smoke.html

clean: \
    abc.clean APL.clean \
    BASIC.clean befunge.clean bf.clean \
    c99.clean cardinal.clean chitchat.clean cola.clean \
    dotnet.clean \
    ecmascript.clean \
    forth.clean \
    hq9plus.clean \
    jako.clean json.clean \
    lisp.clean \
    lolcode.clean lua.clean \
    m4.clean \
    ook.clean \
    parrot_compiler.clean perl6.clean pheme.clean PIR.clean pipp.clean punie.clean pynie.clean \
    regex.clean \
    scheme.clean squaak.clean \
    tcl.clean \
    urm.clean \
    WMLScript.clean \
    Zcode.clean \
    smoke-clean

realclean: \
    abc.realclean APL.realclean \
    befunge.realclean bf.realclean \
    c99.realclean cardinal.realclean chitchat.realclean cola.realclean \
    dotnet.realclean \
    eclectus.realclean ecmascript.realclean \
    forth.realclean \
    hq9plus.realclean \
    jako.realclean json.realclean \
    lazy-k.realclean lisp.realclean lolcode.realclean lua.realclean \
    m4.realclean \
    ook.realclean \
    parrot_compiler.realclean perl6.realclean pheme.realclean PIR.realclean pipp.realclean punie.realclean pynie.realclean \
    regex.realclean \
    scheme.realclean squaak.realclean \
    tcl.realclean \
    urm.realclean unlambda.realclean \
    WMLScript.realclean \
    Zcode.realclean


#
# Language specific targets
#

# The *.dummy targets are a replacement for the target .PHONY in 'GNU make'

abc : abc.dummy
abc.dummy:
	- $(MAKE) abc
abc.test:
	- $(MAKE) abc test
abc.installable:
	- $(MAKE) abc installable
abc.test-installable:
	- $(MAKE) abc test-installable
abc.install:
	- $(MAKE) abc install
abc.clean:
	- $(MAKE) abc clean
abc.realclean:
	- $(MAKE) abc realclean

APL : APL.dummy
APL.dummy:
	- $(MAKE) APL
APL.test:
	- $(MAKE) APL test
APL.installable:
	- $(MAKE) APL installable
APL.test-installable:
	- $(MAKE) APL test-installable
APL.install:
	- $(MAKE) APL install
APL.clean:
	- $(MAKE) APL clean
APL.realclean:
	- $(MAKE) APL realclean

BASIC : BASIC.dummy
BASIC.dummy:
# don't know how to build BASIC
BASIC.test:
# Don't know how to test BASIC
BASIC.installable:
# Missing for BASIC
BASIC.test-installable:
# Missing for BASIC
BASIC.install:
# Missing for BASIC
BASIC.clean:
# Don't know how to clean BASIC

befunge : befunge.dummy
befunge.dummy:
	- $(MAKE) befunge
befunge.test:
	- $(MAKE) befunge test
befunge.installable:
	- $(MAKE) befunge installable
befunge.test-installable:
	- $(MAKE) befunge test-installable
befunge.install:
	- $(MAKE) befunge install
befunge.clean:
	- $(MAKE) befunge clean
befunge.realclean:
	- $(MAKE) befunge realclean

bf : bf.dummy
bf.dummy:
	- $(MAKE) bf
bf.test:
	- $(MAKE) bf test
bf.installable:
	- $(MAKE) bf installable
bf.test-installable:
	- $(MAKE) bf test-installable
bf.install:
	- $(MAKE) bf install
bf.clean:
	- $(MAKE) bf clean
bf.realclean:
	- $(MAKE) bf realclean

c99 : c99.dummy
c99.dummy:
	- $(MAKE) c99
c99.test:
	- $(MAKE) c99 test
c99.installable:
	- $(MAKE) c99 installable
c99.test-installable:
	- $(MAKE) c99 test-installable
c99.install:
	- $(MAKE) c99 install
c99.clean:
	- $(MAKE) c99 clean
c99.realclean:
	- $(MAKE) c99 realclean

cardinal : cardinal.dummy
cardinal.dummy:
	- $(MAKE) cardinal
cardinal.test:
	- $(MAKE) cardinal test
cardinal.installable:
	- $(MAKE) cardinal installable
cardinal.test-installable:
	- $(MAKE) cardinal test-installable
cardinal.install:
	- $(MAKE) cardinal install
cardinal.clean:
	- $(MAKE) cardinal clean
cardinal.realclean:
	- $(MAKE) cardinal realclean

chitchat : chitchat.dummy
chitchat.dummy:
	- $(MAKE) chitchat
chitchat.test:
	- $(MAKE) chitchat test
chitchat.installable:
	- $(MAKE) chitchat installable
chitchat.test-installable:
	- $(MAKE) chitchat test-installable
chitchat.install:
	- $(MAKE) chitchat install
chitchat.clean:
	- $(MAKE) chitchat clean
chitchat.realclean:
	- $(MAKE) chitchat realclean

cola : cola.dummy
cola.dummy:
	- $(MAKE) cola
cola.test:
	- $(MAKE) cola test
cola.installable:
	- $(MAKE) cola installable
cola.test-installable:
	- $(MAKE) cola test-installable
cola.install:
	- $(MAKE) cola install
cola.clean:
	- $(MAKE) cola clean
cola.realclean:
	- $(MAKE) cola realclean

dotnet : dotnet.dummy
dotnet.dummy:
	cd dotnet && $(PERL) Configure.pl
	- $(MAKE) dotnet
dotnet.test:
	- $(MAKE) dotnet test
dotnet.installable:
	- $(MAKE) dotnet installable
dotnet.test-installable:
	- $(MAKE) dotnet test-installable
dotnet.install:
	- $(MAKE) dotnet install
dotnet.clean:
	- $(MAKE) dotnet clean
dotnet.realclean:
	- $(MAKE) dotnet realclean

eclectus: eclectus.dummy
eclectus.dummy:
	- $(MAKE) eclectus
eclectus.test :
	- $(MAKE) eclectus test
eclectus.installable:
	- $(MAKE) eclectus installable
eclectus.test-installable:
	- $(MAKE) eclectus test-installable
eclectus.install:
	- $(MAKE) eclectus install
eclectus.clean :
	- $(MAKE) eclectus clean
eclectus.realclean :
	- $(MAKE) eclectus realclean

ecmascript : ecmascript.dummy
ecmascript.dummy:
	- $(MAKE) ecmascript
ecmascript.test:
	- $(MAKE) ecmascript test
ecmascript.installable:
	- $(MAKE) ecmascript installable
ecmascript.test-installable:
	- $(MAKE) ecmascript test-installable
ecmascript.install:
	- $(MAKE) ecmascript install
ecmascript.clean:
	- $(MAKE) ecmascript clean
ecmascript.realclean:
	- $(MAKE) ecmascript realclean

forth : forth.dummy
forth.dummy:
	- $(MAKE) forth
forth.test:
	- $(MAKE) forth test
forth.installable:
	- $(MAKE) forth installable
forth.test-installable:
	- $(MAKE) forth test-installable
forth.install:
	- $(MAKE) forth install
forth.clean:
	- $(MAKE) forth clean
forth.realclean:
	- $(MAKE) forth realclean

hq9plus: hq9plus.dummy
hq9plus.dummy:
	- $(MAKE) hq9plus
hq9plus.test:
	- $(MAKE) hq9plus test
hq9plus.installable:
	- $(MAKE) hq9plus installable
hq9plus.test-installable:
	- $(MAKE) hq9plus test-installable
hq9plus.install:
	- $(MAKE) hq9plus install
hq9plus.clean:
	- $(MAKE) hq9plus clean
hq9plus.realclean:
	- $(MAKE) hq9plus realclean

jako: jako.dummy
jako.dummy:
	- $(MAKE) jako
jako.test:
	- $(MAKE) jako test
jako.installable:
	- $(MAKE) jako installable
jako.test-installable:
	- $(MAKE) jako test-installable
jako.install:
	- $(MAKE) jako install
jako.clean:
	- $(MAKE) jako clean
jako.realclean:
	- $(MAKE) jako realclean

json: json.dummy
json.dummy:
	- $(MAKE) json
json.test:
	- $(MAKE) json test
json.installable:
	- $(MAKE) json installable
json.test-installable:
	- $(MAKE) json test-installable
json.install:
	- $(MAKE) json install
json.clean:
	- $(MAKE) json clean
json.realclean:
	- $(MAKE) json realclean

lazy-k: lazy-k.dummy
lazy-k.dummy:
	- $(MAKE) lazy-k
lazy-k.test:
	- $(MAKE) lazy-k test
lazy-k.installable:
	- $(MAKE) lazy-k installable
lazy-k.test-installable:
	- $(MAKE) lazy-k test-installable
lazy-k.install:
	- $(MAKE) lazy-k install
lazy-k.clean:
	- $(MAKE) lazy-k clean
lazy-k.realclean:
	- $(MAKE) lazy-k realclean

lisp: lisp.dummy
lisp.dummy:
	- $(MAKE) lisp
lisp.test:
	- $(MAKE) lisp test
lisp.installable:
	- $(MAKE) lisp installable
lisp.test-installable:
	- $(MAKE) lisp test-installable
lisp.install:
	- $(MAKE) lisp install
lisp.clean:
	- $(MAKE) lisp clean
lisp.realclean:
	- $(MAKE) lisp realclean

lolcode: lolcode.dummy
lolcode.dummy:
	- $(MAKE) lolcode
lolcode.test:
	- $(MAKE) lolcode test
lolcode.installable:
	- $(MAKE) lolcode installable
lolcode.test-installable:
	- $(MAKE) lolcode test-installable
lolcode.install:
	- $(MAKE) lolcode install
lolcode.clean:
	- $(MAKE) lolcode clean
lolcode.realclean:
	- $(MAKE) lolcode realclean

lua: lua.dummy
lua.dummy:
	- $(MAKE) lua
lua.test:
	- $(MAKE) lua test
lua.installable:
	- $(MAKE) lua installable
lua.test-installable:
	- $(MAKE) lua test-installable
lua.install:
	- $(MAKE) lua install
lua.clean:
	- $(MAKE) lua clean
lua.realclean:
	- $(MAKE) lua realclean

m4: m4.dummy
m4.dummy:
	- $(MAKE) m4
m4.test:
	- $(MAKE) m4 test
m4.installable:
	- $(MAKE) m4 installable
m4.test-installable:
	- $(MAKE) m4 test-installable
m4.install:
	- $(MAKE) m4 install
m4.clean:
	- $(MAKE) m4 clean
m4.realclean:
	- $(MAKE) m4 realclean

ook : ook.dummy
ook.dummy:
	- $(MAKE) ook
ook.test:
	- $(MAKE) ook test
ook.installable:
	- $(MAKE) ook installable
ook.test-installable:
	- $(MAKE) ook test-installable
ook.install:
	- $(MAKE) ook install
ook.clean:
	- $(MAKE) ook clean
ook.realclean:
	- $(MAKE) ook realclean

parrot_compiler: parrot_compiler.dummy
parrot_compiler.dummy:
	- $(MAKE) parrot_compiler
parrot_compiler.test:
	- $(MAKE) parrot_compiler test
parrot_compiler.installable:
	- $(MAKE) ook installable
parrot_compiler.test-installable:
	- $(MAKE) ook test-installable
parrot_compiler.install:
	- $(MAKE) ook install
parrot_compiler.clean:
	- $(MAKE) parrot_compiler clean
parrot_compiler.realclean:
	- $(MAKE) parrot_compiler realclean

perl6 : perl6.dummy
perl6.dummy:
	- $(MAKE) perl6
perl6.test:
	- $(MAKE) perl6 test
perl6.installable:
	- $(MAKE) perl6 installable
perl6.test-installable:
	- $(MAKE) perl6 test-installable
perl6.install:
	- $(MAKE) perl6 install
perl6.clean:
	- $(MAKE) perl6 clean
perl6.realclean:
	- $(MAKE) perl6 realclean

pheme : pheme.dummy
pheme.dummy:
	- $(MAKE) pheme
pheme.test:
	- $(MAKE) pheme test
pheme.installable:
	- $(MAKE) pheme installable
pheme.test-installable:
	- $(MAKE) pheme test-installable
pheme.install:
	- $(MAKE) pheme install
pheme.clean:
	- $(MAKE) pheme clean
pheme.realclean:
	- $(MAKE) pheme realclean

pipp : pipp.dummy
pipp.dummy:
	- $(MAKE) pipp
pipp.test:
	- $(MAKE) pipp test
pipp.installable:
	- $(MAKE) pipp installable
pipp.test-installable:
	- $(MAKE) pipp test-installable
pipp.install:
	- $(MAKE) pipp install
pipp.clean:
	- $(MAKE) pipp clean
pipp.realclean:
	- $(MAKE) pipp realclean

PIR: PIR.dummy
PIR.dummy:
	- $(MAKE) PIR
PIR.test:
	- $(MAKE) PIR test
PIR.installable:
	- $(MAKE) PIR installable
PIR.test-installable:
	- $(MAKE) PIR test-installable
PIR.install:
	- $(MAKE) PIR install
PIR.clean:
	- $(MAKE) PIR clean
PIR.realclean:
	- $(MAKE) PIR realclean

punie : punie.dummy
punie.dummy:
	- $(MAKE) punie
punie.test:
	- $(MAKE) punie test
punie.installable:
	- $(MAKE) punie installable
punie.test-installable:
	- $(MAKE) punie test-installable
punie.install:
	- $(MAKE) punie install
punie.clean:
	- $(MAKE) punie clean
punie.realclean:
	- $(MAKE) punie realclean

pynie : pynie.dummy
pynie.dummy:
	- $(MAKE) pynie
pynie.test:
	- $(MAKE) pynie test
pynie.installable:
	- $(MAKE) pynie installable
pynie.test-installable:
	- $(MAKE) pynie test-installable
pynie.install:
	- $(MAKE) pynie install
pynie.clean:
	- $(MAKE) pynie clean
pynie.realclean:
	- $(MAKE) pynie realclean

regex: regex.dummy
regex.dummy:
	- $(MAKE) regex
regex.test :
	- $(MAKE) regex test
regex.installable:
	- $(MAKE) regex installable
regex.test-installable:
	- $(MAKE) regex test-installable
regex.install:
	- $(MAKE) regex install
regex.clean :
	- $(MAKE) regex clean
regex.realclean :
	- $(MAKE) regex realclean

scheme: scheme.dummy
scheme.dummy:
	@echo "SKIPPED: scheme: (nothing to make, but should not default to make test)"
scheme.test :
	- $(MAKE) scheme test
scheme.installable:
	- $(MAKE) scheme installable
scheme.test-installable:
	- $(MAKE) scheme test-installable
scheme.install:
	- $(MAKE) scheme install
scheme.clean :
	- $(MAKE) scheme clean
scheme.realclean :
	- $(MAKE) scheme realclean

squaak: squaak.dummy
squaak.dummy:
	- $(MAKE) squaak
squaak.test:
	- $(MAKE) squaak test
squaak.installable:
	- $(MAKE) squaak installable
squaak.test-installable:
	- $(MAKE) squaak test-installable
squaak.install:
	- $(MAKE) squaak install
squaak.clean:
	- $(MAKE) squaak clean
squaak.realclean:
	- $(MAKE) squaak realclean

tcl: tcl.dummy
tcl.dummy:
	- $(MAKE) tcl
tcl.test:
	- $(MAKE) tcl test
tcl.installable:
	- $(MAKE) tcl installable
tcl.test-installable:
	- $(MAKE) tcl test-installable
tcl.install:
	- $(MAKE) tcl install
tcl.clean:
	- $(MAKE) tcl clean
tcl.realclean:
	- $(MAKE) tcl realclean

unlambda: unlambda.dummy
unlambda.dummy:
	- $(MAKE) unlambda
unlambda.test :
	- $(MAKE) unlambda test
unlambda.installable:
	- $(MAKE) unlambda installable
unlambda.test-installable:
	- $(MAKE) unlambda test-installable
unlambda.install:
	- $(MAKE) unlambda install
unlambda.clean :
	- $(MAKE) unlambda clean
unlambda.realclean :
	- $(MAKE) unlambda realclean

urm: urm.dummy
urm.dummy:
	- $(MAKE) urm
urm.test:
	- $(MAKE) urm test
urm.installable:
	- $(MAKE) urm installable
urm.test-installable:
	- $(MAKE) urm test-installable
urm.install:
	- $(MAKE) urm install
urm.clean:
	- $(MAKE) urm clean
urm.realclean:
	- $(MAKE) urm realclean

WMLScript: WMLScript.dummy
WMLScript.dummy:
	- $(MAKE) WMLScript
WMLScript.test:
	- $(MAKE) WMLScript test
WMLScript.installable:
	- $(MAKE) WMLScript installable
WMLScript.test-installable:
	- $(MAKE) WMLScript test-installable
WMLScript.install:
	- $(MAKE) WMLScript install
WMLScript.clean:
	- $(MAKE) WMLScript clean
WMLScript.realclean:
	- $(MAKE) WMLScript realclean

Zcode : Zcode.dummy
Zcode.dummy:
# Do nothing. make Zcode requires an Inform compiler
Zcode.test:
	- $(MAKE) Zcode test
Zcode.installable:
# Do nothing. make Zcode requires an Inform compiler
Zcode.test-installable:
# Do nothing. make Zcode requires an Inform compiler
Zcode.install:
# Do nothing. make Zcode requires an Inform compiler
Zcode.clean:
	- $(MAKE) Zcode clean
Zcode.realclean:
	- $(MAKE) Zcode realclean

#
# Local variables:
# mode: makefile
# ex: ft=make
# End:
